<!DOCTYPE html>
{% extends 'layouts/base.html' %}
{% load static %}

{% block content %}
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Registro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
        body {
            margin-bottom: 100px;
        }
    </style>
</head>

<header class="bg-dark text-white py-3">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <img src="https://i.imgur.com/z4gMSNl.png" alt="Logo" style="height: 150px;">
        </div>
        <div>
            <h1>Sistema de Registro de Permisos</h1>
            <p>Bienvenido a el Sistema de Registro de Permisos</p>
        </div>
    </div>
</header>
<nav class="navbar navbar-dark bg-secondary py-1">
    <div class="container d-flex justify-content-center">
        <span class="navbar-text fw-bold fs-6 text-dark text-center">
            SISTEMA DE REGISTRO DE LICENCIAS ÚNICAMENTE PARA ASIGNATURAS DE LA CARRERA DE INGENIERÍA MECATRÓNICA
        </span>
    </div>
</nav>

<body>
    <div class="container">
        <h2>Registro de estudiante</h2>
        <form method="POST" id="form-permisos" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row g-3 mb-4">
                <div class="fieldWrapper col">
                    <div class="input-group flex-nowrap">
                        {{ form.nombre.errors }}
                        <label for="{{ form.nombre.id_for_label }}" class="input-group-text">Nombre(s):</label>
                        <input type="text" name="{{ form.nombre.html_name }}" required
                            id="{{ form.nombre.id_for_label }}" class="form-control" placeholder="Ej: Diego Andrés"
                            aria-label="Ej: Diego Andrés" aria-describedby="addon-wrapping">
                    </div>
                </div>

                <div class="fieldWrapper col">
                    <div class="input-group flex-nowrap">
                        {{ form.apellido.errors }}
                        <label for="{{ form.apellido.id_for_label }}" class="input-group-text">Apellido(s):</label>
                        <input type="text" name="{{ form.apellido.html_name }}" required
                            id="{{ form.apellido.id_for_label }}" class="form-control"
                            placeholder="Ej: Calvimontes Vera" aria-label="Ej: Calvimontes Vera"
                            aria-describedby="addon-wrapping">
                    </div>
                </div>
            </div>


            <div class="fieldWrapper">
                <div class="input-group flex-nowrap mb-4">
                    {{ form.email.errors }}
                    <label for="{{ form.email.id_for_label }}" class="input-group-text">Correo electrónico:</label>
                    <input type="email" name="{{ form.email.html_name }}" required id="{{ form.email.id_for_label }}"
                        class="form-control" placeholder="Ej: diego.calvimontes@ucb.edu.bo"
                        aria-label="Ej: diego.calvimontes@ucb.edu.bo" aria-describedby="addon-wrapping"
                        autocomplete="off">
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="fieldWrapper col">
                    <div class="input-group flex-nowrap">
                        {{ form.ci.errors }}
                        <label for="{{ form.ci.id_for_label }}" class="input-group-text">Cédula de identidad:</label>
                        <input type="number" name="{{ form.ci.html_name }}" required id="{{ form.ci.id_for_label }}"
                            class="form-control" placeholder="Ej: 7511812" aria-label="Ej: 7511812"
                            aria-describedby="addon-wrapping">
                    </div>
                </div>
                <div class="fieldWrapper col">
                    <div class="input-group flex-nowrap">
                        <label for="id_permisos-0-justificacion" class="input-group-text">Ingrese PDF</label>
                        <input type="file" name="permisos-0-justificacion" id="id_permisos-0-justificacion"
                            class="form-control" aria-describedby="addon-wrapping">
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <h3>Descripción:</h3>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" value="Salud" name="flexRadioDefault" id="motivo">
                    <label class="form-check-label" for="motivo">
                        Salud
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" value="Actividad académica" name="flexRadioDefault"
                        id="motivo">
                    <label class="form-check-label" for="motivo">
                        Actividad académica
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" value="Actividad deportiva/cultural"
                        name="flexRadioDefault" id="motivo">
                    <label class="form-check-label" for="motivo">
                        Actividad deportiva/cultural
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" value="Asunto familiar" name="flexRadioDefault"
                        id="motivo">
                    <label class="form-check-label" for="motivo">
                        Asunto familiar
                    </label>
                </div>
                <div class="form-check col">
                    <input class="form-check-input" type="radio" value="Otro" name="flexRadioDefault" id="motivo">
                    <label class="form-check-label" for="motivo">
                        Otro
                    </label>
                </div>
            </div>

            <div class="mb-4">
                <div class="input-group">
                    <label for="id_permisos-0-descripcion" class="input-group-text">Descripción:</label>
                    <textarea name="permisos-0-descripcion" required id="id_permisos-0-descripcion" class="form-control"
                        rows="3" aria-label="Descripción" autocomplete="off"></textarea>
                </div>
            </div>

            <div>
                <h2>Registro de materias</h2>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Materia</th>
                            <th scope="col">Hora de inicio</th>
                            <th scope="col">Hora de fin</th>
                            <th scope="col">Fecha</th>
                        </tr>
                    </thead>
                    <tbody id="permisos-cuerpo">
                        {{ formset.management_form }}
                        <tr class="permiso-fila">
                            <th scope="row">1</th>
                            <td>
                                <label for="id_permisos-0-materia"></label>
                                <select class="form-select" name="permisos-0-materia"
                                    aria-label="Default select example">
                                    <option selected>-</option>
                                    <option value="Automatización Industrial">Automatización Industrial</option>
                                    <option value="Autotrónica">Autotrónica</option>
                                    <option value="Circuitos Digitales">Circuitos Digitales</option>
                                    <option value="Circuitos Electrónicos I">Circuitos Electrónicos I</option>
                                    <option value="Circuitos Electrónicos II">Circuitos Electrónicos II</option>
                                    <option value="Circuitos Electrónicos III">Circuitos Electrónicos III</option>
                                    <option value="Control I">Control I</option>
                                    <option value="Control II">Control II</option>
                                    <option value="Diseño de Máquinas">Diseño de Máquinas</option>
                                    <option value="Diseño Superior de Ingenieria">Diseño Superior de Ingenieria</option>
                                    <option value="Electrónica de Potencia">Electrónica de Potencia</option>
                                    <option value="Fundamentos de Control">Fundamentos de Control</option>
                                    <option value="Instrumentación Industrial">Instrumentación Industrial</option>
                                    <option value="Introducción a la Ing. Mecatrónica">Introducción a la Ing.
                                        Mecatrónica</option>
                                    <option value="Manufatura Integrada">Manufatura Integrada</option>
                                    <option value="Máquinas Eléctricas">Máquinas Eléctricas</option>
                                    <option value="Mecanismos">Mecanismos</option>
                                    <option value="Neumática e Hidráulica">Neumática e Hidráulica</option>
                                    <option value="Prácticas Preprofesionales">Prácticas Preprofesionales</option>
                                    <option value="Programación Superior">Programación Superior</option>
                                    <option value="Prototipado Rápido">Prototipado Rápido</option>
                                    <option value="Robótica">Robótica</option>
                                    <option value="Señales y Sistemas">Señales y Sistemas</option>
                                    <option value="Sistemas Embebidos I">Sistemas Embebidos I</option>
                                    <option value="Sistemas Embebidos II">Sistemas Embebidos II</option>
                                    <option value="Taller de Grado I">Taller de Grado I</option>
                                    <option value="Taller de Grado II">Taller de Grado II</option>
                                    <option value="Tecnología Mecánica">Tecnología Mecánica</option>
                                    <option value="Visión Artificial">Visión Artificial</option>
                                </select>
                            </td>
                            <td>
                                <label for="id_permisos-0-horaInicio"></label>
                                <input type="time" name="permisos-0-horaInicio" aria-describedby="addon-wrapping"
                                    class="form-control">
                            </td>
                            <td>
                                <label for="id_permisos-0-horaFin"></label>
                                <input type="time" name="permisos-0-horaFin" aria-describedby="addon-wrapping"
                                    class="form-control">
                            </td>
                            <td>
                                <label for="id_permisos-0-fecha"></label>
                                <input type="date" name="permisos-0-fecha" aria-describedby="addon-wrapping"
                                    class="form-control">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="row">
                <button type="button" class="btn btn-outline-dark col-md-2" id="guardar-registro" data-bs-toggle="modal"
                    data-bs-target="#confirmarModal">Registrar permiso</button>
                <div class="col-md-9"></div>
                <div class="btn-group col-md-1" role="group" aria-label="Basic mixed styles example">
                    <button type="button" class="btn btn-outline-success" id="agregar-materia">+</button>
                    <button type="button" class="btn btn-outline-danger" id="eliminar-materia">-</button>
                </div>
            </div>
        </form>

        <div class="modal fade" id="confirmarModal" tabindex="-1" aria-labelledby="confirmarModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="confirmarModalLabel">Aviso de registro</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ¿Está seguro de registrar los datos ingresados?<br />
                        Si es así, presione el botón "Registar permiso".
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                        <button type="button" class="btn btn-primary" id="confirmarGuardar">Registrar permiso</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        window.permisoCount = {{ formset.total_form_count }};
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"></script>
    <script src="{% static 'registro/script.js' %}"></script>

</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Función para aplicar el filtrado de fechas
        function aplicarFiltrado() {
            // Obtén todos los elementos de entrada de fecha
            var fechaInputs = document.querySelectorAll('input[type="date"]');

            // Itera sobre los elementos de entrada de fecha y establece los atributos
            fechaInputs.forEach(function (fechaInput) {
                // Configura la fecha mínima permitida para cada campo de fecha
                var fechaActual = new Date();
                var fechaMinima = new Date(fechaActual);
                fechaMinima.setDate(fechaActual.getDate() - 20);

                // Convierte la fecha mínima a formato ISO (YYYY-MM-DD)
                var fechaMinimaISO = fechaMinima.toISOString().split('T')[0];

                fechaInput.setAttribute('min', fechaMinimaISO);
                
                // Agrega un manejador de eventos para prevenir la edición manual
                fechaInput.addEventListener('keydown', prevenirEdicionManual);
            });
        }

        // Función para prevenir la edición manual de la fecha
        function prevenirEdicionManual(event) {
            event.preventDefault();
        }

        // Aplicar el filtrado al cargar la página
        aplicarFiltrado();

        // Observador de mutaciones para detectar nuevos elementos de entrada de fecha
        var observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.addedNodes && mutation.addedNodes.length > 0) {
                    // Si se agregan nuevos nodos, aplicar el filtrado nuevamente
                    aplicarFiltrado();
                }
            });
        });

        // Configurar el observador para observar cambios en el cuerpo del documento
        observer.observe(document.body, { childList: true, subtree: true });
    });
</script>


{% endblock %}